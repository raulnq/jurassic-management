@using Microsoft.AspNetCore.Http.Extensions
@using WebAPI.Infrastructure.SqlKata
@typeparam TResult

<nav>
    <ul class="pagination">
        <li class="page-item @(Result.HasPreviousPage?"":"disabled")">
            @if (string.IsNullOrEmpty(Select))
            {
                <a class="page-link"
                   href="#"
                   hx-get="@GetUrl(Query.Page-1)"
                   hx-swap=@Swap
                   hx-target="@Target">Previous</a>
            }
            else
            {
                <a class="page-link"
                   href="#"
                   hx-get="@GetUrl(Query.Page-1)"
                   hx-swap=@Swap
                   hx-target="@Target" hx-select=@Select>Previous</a>
            }

        </li>
        @for (int i = 1; i <= Result.TotalPages; i++)
        {
            @if (string.IsNullOrEmpty(Select))
            {
                <li class="page-item @(Result.Page==i?"active":"")">
                    <a class="page-link"
                       href="#"
                       hx-get="@GetUrl(i)"
                       hx-swap=@Swap
                       hx-target="@Target">@i</a>
                </li>
            }
            else
            {
                <li class="page-item @(Result.Page==i?"active":"")">
                    <a class="page-link"
                       href="#"
                       hx-get="@GetUrl(i)"
                       hx-swap=@Swap
                       hx-target="@Target" hx-select=@Select>@i</a>
                </li>
            }

        }
        @if (string.IsNullOrEmpty(Select))
        {
            <li class="page-item @(Result.HasNextPage?"":"disabled")">
                <a class="page-link"
                   href="#"
                   hx-get="@GetUrl(Query.Page+1)"
                   hx-swap=@Swap
                   hx-target="@Target">Next</a>
            </li>
        }
        else
        {
            <li class="page-item @(Result.HasNextPage?"":"disabled")">
                <a class="page-link"
                   href="#"
                   hx-get="@GetUrl(Query.Page+1)"
                   hx-swap=@Swap
                   hx-target="@Target" hx-select=@Select>Next</a>
            </li>
        }

    </ul>
</nav>

@code {
    [Parameter, EditorRequired]
    public ListQuery Query { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListResults<TResult> Result { get; set; } = default!;
    [Parameter, EditorRequired]
    public string Endpoint { get; set; } = default!;
    [Parameter]
    public IEnumerable<KeyValuePair<string, object?>> Parameters { get; set; } = default!;
    [Parameter, EditorRequired]
    public string Target { get; set; } = default!;
    [Parameter]
    public string Swap { get; set; } = "innerHTML";
    [Parameter]
    public string Select { get; set; } = default!;
    public string GetUrl(int page)
    {
        var parameters = new List<KeyValuePair<string, string>>();
        if (Parameters != null)
        {
            foreach (var parameter in Parameters.Where(p => p.Value != null))
            {
                parameters.Add(new KeyValuePair<string, string>(parameter.Key, parameter.Value!.ToString()));
            }
        }
        parameters.Add(new KeyValuePair<string, string>("page", page.ToString()));
        parameters.Add(new KeyValuePair<string, string>("pageSize", Query.PageSize.ToString()));
        parameters.Add(new KeyValuePair<string, string>("ascending", Query.Ascending.ToString()));
        var queryBuilder = new QueryBuilder(parameters);
        return Endpoint + queryBuilder;
    }

}
