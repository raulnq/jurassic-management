@using WebAPI.Infrastructure.SqlKata;
@using WebAPI.Infrastructure.Ui;
@using WebAPI.Proformas;
@using global::Infrastructure

<Section Title=@Endpoints.WorkItemTitle>
    <Content>
        <Toolbar>
            <Actions>
                <ActionButton Text=@Endpoints.AddWorkItemTitle
                              Icon=@Icons.Add
                              IsDisabled=@(GetProformaResult.Status !=ProformaStatus.Pending.ToString())
                              HtmxProps=@(new HtmxProps(Endpoints.GetAddWorkItem(Query.ProformaId!.Value, Query.Week!.Value), Infrastructure.Ui.Targets.Dialog)) />
            </Actions>
        </Toolbar>
        <div id=@Targets.CollaboratorList>
            <DataTable TResult=ListProformaWeekWorkItems.Result
                       Result=@Result.Items
                       Context="item">
                <TableHeader>
                    <th></th>
                    <th>Collaborator</th>
                    <th>Role</th>
                    <th>Hours</th>
                    <th>Free Hours</th>
                    <th class="text-end">SubTotal</th>
                    <th class="text-end">Fee Amount</th>
                </TableHeader>
                <RowTemplate>
                    <RowToolbar>
                        <Actions>
                            <ActionLink HtmxProps=@(new HtmxProps(Endpoints.GetEditWorkItem(item.ProformaId, item.Week, item.CollaboratorId), Infrastructure.Ui.Targets.Dialog))
                                        IsDisabled=@(GetProformaResult.Status !=ProformaStatus.Pending.ToString())
                                        Icon=@Icons.Edit />
                            <ActionLink HtmxProps=@(new HtmxProps(Endpoints.GetRemoveWorkItem(item.ProformaId, item.Week, item.CollaboratorId), $"#{Targets.CollaboratorList}",Swap.OuterHTML, $"#{Targets.CollaboratorList}"){ Confirm = "Are you sure?", HttpMethod="DELETE"})
                                        IsDisabled=@(GetProformaResult.Status !=ProformaStatus.Pending.ToString())
                                        Icon=@Icons.Delete />
                        </Actions>
                    </RowToolbar>
                    <td>@item.CollaboratorName</td>
                    <td>@item.CollaboratorRoleName</td>
                    <td>@item.Hours</td>
                    <td>@item.FreeHours</td>
                    <td class="text-end">@item.SubTotal.ToMoneyFormat()</td>
                    <td class="text-end">@item.FeeAmount.ToMoneyFormat()</td>
                </RowTemplate>
            </DataTable>
            <Pagination Query=@Query
                        Result=@Result
                        HtmxProps=@(new HtmxProps(Endpoints.GetListWorkItems(Query.ProformaId!.Value, Query.Week!.Value), $"#{Targets.CollaboratorList}", Swap.OuterHTML, $"#{Targets.CollaboratorList}")) />
        </div>
    </Content>
</Section>
<div id=@Targets.ProformaTotals hx-swap-oob="true">
    <TotalsSectionPage Result=@GetProformaResult />
</div>
<div id="@Targets.WeekColumnPenalty-@GetProformaWeekResult.Week" hx-swap-oob="true">@GetProformaWeekResult.Penalty</div>
<div id="@Targets.WeekColumnSubTotal-@GetProformaWeekResult.Week" hx-swap-oob="true">@GetProformaWeekResult.SubTotal</div>
@code {
    [Parameter, EditorRequired]
    public ListResults<ListProformaWeekWorkItems.Result> Result { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListProformaWeekWorkItems.Query Query { get; set; } = default!;
    [Parameter, EditorRequired]
    public GetProforma.Result GetProformaResult { get; set; } = default!;
    [Parameter, EditorRequired]
    public GetProformaWeek.Result GetProformaWeekResult { get; set; } = default!;
}
