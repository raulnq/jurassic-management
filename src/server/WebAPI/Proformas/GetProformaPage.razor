@using WebAPI.Clients
@using WebAPI.JiraProfiles
@using WebAPI.ProformaDocuments
@using WebAPI.Proformas;
@using WebAPI.Infrastructure.SqlKata;
@using WebAPI.Infrastructure.Ui;

<Heading Text=@Endpoints.Title />
<Breadcrumbs Links=@(new Breadcrumbs.Link[]{ new(Endpoints.ListTitle, Endpoints.List.AddListParameters()), new(Endpoints.ViewTitle) })
             Target=@($"#{WebAPI.Users.MainPage.Workspace}")>
    <MenuItems>
        <MenuItem Text="Issue"
                  IsDisabled=@(Result.Status!=ProformaStatus.Pending.ToString())
                  HtmxProps=@(new HtmxProps(Endpoints.Issue, $"#{WebAPI.Users.MainPage.Dialog}"){Vals=$$"""{"proformaId":"{{Result.ProformaId}}"}"""}) />
        <MenuItem HtmxProps=@(new HtmxProps(Endpoints.Cancel, $"#{WebAPI.Users.MainPage.Workspace}"){ Confirm = "Are you sure?", HttpMethod="POST", Vals=$$"""{"proformaId":"{{Result.ProformaId}}"}"""})
                  IsDisabled=@(Result.Status !=ProformaStatus.Pending.ToString())
                  Text="Cancel" />
    </MenuItems>
</Breadcrumbs>
<Toolbar>
    <Actions>
        <Divider />
        <Text Property=@nameof(GetProforma.Result.Number)
              Value=@Result.Number
              Label="Number" />
        <Divider />
        <Link Property=@nameof(GetProformaDocument.Result.Url)
              Value="View"
              Href=@GetProformaDocumentResult?.Url
              IsDisabled=@(GetProformaDocumentResult==null)
              Label="PDF" />
        <Divider />
        <Text Property=@nameof(GetProforma.Result.Status)
              Value=@Result.Status
              Label="Status" />
        <Divider />
    </Actions>
</Toolbar>
<Section>
    <Content>
        <FormRow>
            <Content>
                <div class="col-4">
                    <DateInput Property=@nameof(GetProforma.Result.Start)
                               Label="Start date"
                               Value=@Result.Start
                               Readonly=true />
                </div>
                <div class="col-4">
                    <DateInput Property=@nameof(GetProforma.Result.End)
                               Label="End date"
                               Value=@Result.End
                               Readonly=true />
                </div>
                <div class="col-4">
                    <SelectInput Property=@nameof(GetProforma.Result.Currency)
                                 Label="Currency"
                                 TKey=int
                                 Value=@Result.Currency
                                 Readonly=true>
                    </SelectInput>
                </div>
            </Content>
        </FormRow>
        <FormRow>
            <Content>
                <div class="col-6">
                    <SelectInput Property=@nameof(GetProforma.Result.ClientName)
                                 Label="Client"
                                 TKey=Guid
                                 Value=@Result.ClientName
                                 Readonly=true>
                    </SelectInput>
                </div>
                <div class="col-6">
                    <SelectInput Property=@nameof(GetProforma.Result.ProjectName)
                                 Label="Project"
                                 Value=@Result.ProjectName
                                 Readonly=true
                                 TKey=Guid>
                    </SelectInput>
                </div>
            </Content>
        </FormRow>
        <div id=@Totals>
            <TotalsSectionPage Total=@Result.Total
                               Commission=@Result.Commission
                               Discount=@Result.Discount
                               SubTotal=@Result.SubTotal />
        </div>
    </Content>
</Section>
<Section Title=@Endpoints.WeekTitle>
    <Content>
        <ListProformaWeeksPage Query=@ListProformaWeeksQuery
                               Result=@ListProformaWeeksResult />
    </Content>
</Section>
<div id=@Collaborator>
</div>

@code {
    [Parameter, EditorRequired]
    public GetProforma.Result Result { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListResults<ListProformaWeeks.Result> ListProformaWeeksResult { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListProformaWeeks.Query ListProformaWeeksQuery { get; set; } = default!;
    [Parameter, EditorRequired]
    public GetProformaDocument.Result? GetProformaDocumentResult { get; set; }

    public const string Totals = "proforma-totals-target";

    public const string Collaborator = "collaborator-target";
}
