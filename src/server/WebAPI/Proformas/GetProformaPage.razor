@using WebAPI.Clients
@using WebAPI.Proformas;
@using WebAPI.Infrastructure.SqlKata;
@using WebAPI.Infrastructure.Ui;

<Heading Text="Proformas" />
<Breadcrumbs Links=@(new Breadcrumbs.Link[]{ new("List proformas", Endpoints.List.AddListParameters()), new("Edit proforma") })
             Target=@(Targets.Workspace)>
    <MenuItems>
        <MenuItem Text="Issue"
                  IsDisabled=@(Result.Status!=ProformaStatus.Pending.ToString())
                  HtmxProps=@(new HtmxProps(Endpoints.Issue.Replace("{proformaId}", @Result.ProformaId),Targets.Dialog)) />
    </MenuItems>
</Breadcrumbs>
<Toolbar>
    <Actions>
        <Divider />
        <Text Property=@nameof(GetProforma.Result.Status)
              Value=@Result.Status
              Label="Status" />
        <Divider />
    </Actions>
</Toolbar>
<Section>
    <Content>
        <FormRow>
            <Content>
                <div class="col-4">
                    <DateInput Property=@nameof(GetProforma.Result.Start)
                               Label="Start date"
                               Value=@Result.Start
                               Readonly=true />
                </div>
                <div class="col-4">
                    <DateInput Property=@nameof(GetProforma.Result.End)
                               Label="End date"
                               Value=@Result.End
                               Readonly=true />
                </div>
                <div class="col-4">
                    <SelectInput Property=@nameof(GetProforma.Result.Currency)
                                 Label="Currency"
                                 TKey=int
                                 Value=@Result.Currency
                                 Readonly=true>
                    </SelectInput>
                </div>
            </Content>
        </FormRow>
        <FormRow>
            <Content>
                <div class="col-6">
                    <SelectInput Property=@nameof(GetProforma.Result.ClientName)
                                 Label="Client"
                                 TKey=Guid
                                 Value=@Result.ClientName
                                 Readonly=true>
                    </SelectInput>
                </div>
                <div class="col-6">
                    <SelectInput Property=@nameof(GetProforma.Result.ProjectName)
                                 Label="Project"
                                 Value=@Result.ProjectName
                                 Readonly=true
                                 TKey=Guid>
                    </SelectInput>
                </div>
            </Content>
        </FormRow>
        <div id="totals-section">
            <TotalsSectionPage Result=@Result />
        </div>
    </Content>
</Section>
<Section Title="Weeks">
    <Content>
        <div id="weeks-section">
            <ListProformaWeeksPage Query=@ListProformaWeeksQuery
                                   Result=@ListProformaWeeksResult />
        </div>
    </Content>
</Section>
<div id="collaborator-section">
</div>

@code {
    [Parameter, EditorRequired]
    public GetProforma.Result Result { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListResults<ListProformaWeeks.Result> ListProformaWeeksResult { get; set; } = default!;
    [Parameter, EditorRequired]
    public ListProformaWeeks.Query ListProformaWeeksQuery { get; set; } = default!;
}
